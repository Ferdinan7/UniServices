# ADR-002-v2: Elección de PostgreSQL con Supabase como sistema de almacenamiento de datos

**Estado:** Adoptado  

## Contexto  
El backend se desarrollará en **NestJS y GraphQL**.  
Se requiere un motor de almacenamiento robusto, escalable y con soporte para APIs.  
Se busca optimizar la gestión de datos relacionales, reducir la complejidad operativa y facilitar la integración con servicios gestionados.  

## Referencia histórica  
Este ADR reemplaza y modifica la propuesta documentada en el ADR-002 (“Elección de PostgreSQL y Redis como sistemas de almacenamiento de datos”).  

## Decisión  
Se selecciona **PostgreSQL** como base de datos principal, utilizando **Supabase** como plataforma BaaS (Backend-as-a-Service) para manejar información relacional, usuarios, inscripciones, pagos, incidencias y administración del sistema.  
Supabase ofrece integración directa con PostgreSQL, soporte para GraphQL/REST, autenticación nativa, gestión de roles y funciones de seguridad alineadas con los requisitos del proyecto.  

No se utiliza Redis. Aunque en ADR-002 se consideró este motor para sesiones y cacheo, se optó por centralizar control y persistencia en Supabase/PostgreSQL, aprovechando funciones nativas, vistas materializadas y políticas de acceso.  

## Consecuencias  
- Facilita el desarrollo con NestJS y GraphQL gracias a la compatibilidad nativa con PostgreSQL.  
- Supabase reduce la carga operativa ofreciendo panel de administración, backups automáticos y reglas de seguridad.  
- El rendimiento es optimizado mediante SQL avanzado y control granular, sin integrar Redis.  
- Mejora la escalabilidad y mantenibilidad, eliminando la necesidad de múltiples motores de almacenamiento.  
- La arquitectura depende de los límites y capacidades de Supabase, requiriendo monitoreo activo para futuras necesidades de rendimiento.  

## Alternativas Consideradas  
- PostgreSQL autogestionado + Redis: Mayor control, más complejidad operativa.  
- Bases de datos solo relacionales (MySQL, SQL Server): Menor flexibilidad con GraphQL.  
- NoSQL (MongoDB): Menos adecuado para datos estructurados y relacionales.  
- Firebase o BaaS similares: Menor compatibilidad con SQL y menos control sobre el modelo de datos.  
